@model IPCU.Models.VentilatorEventChecklist

@{
    ViewData["Title"] = "Ventilator-Associated Event (VAE) Checklist";
}

<div class="container mt-4">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
            <h4 class="text-center">NATIONAL KIDNEY AND TRANSPLANT INSTITUTE</h4>
            <p class="text-center">Infection Prevention and Control Unit</p>
            <h5 class="text-center">Ventilator-Associated Event (VAE) Checklist</h5>
        </div>

        <div class="card-body">
            <form asp-controller="VentilatorEventChecklist" asp-action="Submit" method="post">
                @Html.AntiForgeryToken()

                <!-- Patient Information -->
                <div class="row">
                    <div class="col-md-4">
                        <label>Last Name:</label>
                        <input asp-for="LName" class="form-control" required />
                    </div>
                    <div class="col-md-4">
                        <label>First Name:</label>
                        <input asp-for="FName" class="form-control" required />
                    </div>
                    <div class="col-md-4">
                        <label>Middle Name:</label>
                        <input asp-for="MName" class="form-control" />
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label>Hospital Number:</label>
                        <input asp-for="HospNum" class="form-control" required />
                    </div>
                    <div class="col-md-4">
                        <label>Date of Admission:</label>
                        <input asp-for="DateOfAdmission" type="date" class="form-control" required />
                    </div>

                    <div class="col-md-4">
                        <label>Disposition:</label>
                        <select asp-for="Disposition" id="dispositionDropdown" class="form-control" onchange="toggleDispositionTransferField()">
                            <option value="">-- Select Disposition --</option>
                            <option value="Transferred In">Transferred In</option>
                            <option value="Transferred Out">Transferred Out</option>
                            <option value="Mortality">Mortality</option>
                            <option value="Discharged">Discharged</option>
                            <option value="Still admitted">Still admitted</option>
                        </select>
                    </div>

                    <!-- Disposition Date and Disposition Transfer Fields -->
                    <div class="row mt-3">
                        <!-- Disposition Date Field (Always Visible, Left Side) -->
                        <div class="col-md-4">
                            <label>Disposition Date:</label>
                            <input asp-for="DispositionDate" type="date" class="form-control" required />
                        </div>

                        <!-- Disposition Transfer Field (Hidden by Default, Right Side) -->
                        <div id="dispositionTransferField" class="col-md-4" style="display: none;">
                            <label>Disposition Transfer:</label>
                            <input asp-for="DispositionTransfer" class="form-control" />
                        </div>
                    </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label>Date of Birth:</label>
                        <input asp-for="DateOfBirth" type="date" class="form-control" required />
                    </div>
                    <div class="col-md-4">
                        <label>Age:</label>
                        <input asp-for="Age" class="form-control" required />
                    </div>
                    <div class="col-md-4">
                        <label for="genderSelect">Sex/Gender:</label>
                        <select asp-for="Gender" class="form-control" id="genderSelect">
                            <option value="">-- Select Gender --</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label>Unit/Ward/Area</label>
                        <input asp-for="UwArea" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label>Classification:</label>
                        <div class="form-check">
                            <input asp-for="Classification" type="radio" class="form-check-input" value="Pay" checked />
                            <label class="form-check-label">Pay</label>
                        </div>
                        <div class="form-check">
                            <input asp-for="Classification" type="radio" class="form-check-input" value="Service" />
                            <label class="form-check-label">Service</label>
                        </div>
                    </div>
                </div>

                    <div class="row mt-3">
                        <div class="col-md-5">
                            <label>MDRO (Multi-Drug Resistant Organism):</label>
                            <div class="form-check">
                                <input asp-for="MDRO" type="radio" class="form-check-input" value="true" id="mdroYes" onchange="toggleMDROOrganismField()" />
                                <label class="form-check-label" for="mdroYes">Yes</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="MDRO" type="radio" class="form-check-input" value="false" id="mdroNo" onchange="toggleMDROOrganismField()" />
                                <label class="form-check-label" for="mdroNo">No</label>
                            </div>
                        </div>

                    </div>

                    <!-- MDROOrganism Field (Hidden by Default) -->
                    <div class="row mt-3">
                        <div id="mdroOrganismField" class="col-md-4" style="display: none;">
                            <label for="mdroOrganism">MDRO Organism:</label>
                            <input asp-for="MDROOrganism" class="form-control" id="mdroOrganism" style="width: 100%;" />
                        </div>
                    </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label>Main Service:</label>
                        <input asp-for="MainService" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label>Date of Event (DOE):</label>
                        <input asp-for="DateOfEvent" type="date" class="form-control" required />
                    </div>
                    <div class="col-md-4">
                        <label>Date of Intubation:</label>
                        <input asp-for="DateOfIntubation" type="date" class="form-control" />
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label>Name of Investigator:</label>
                        <input asp-for="NameOfInvestigator" class="form-control" />
                    </div>                 
                </div>

                    <!-- Type Classification (Concatenated Checkboxes) -->
                    <div class="card shadow-sm border-0 mt-4">
                        <div class="card-header bg-primary text-white text-center">
                            <h5 class="mb-0">Type Classification</h5>
                        </div>
                        <div class="card-body">
                            <label class="fw-bold">Select Type:</label>
                            <div class="d-flex gap-3 mt-2">
                                <div class="form-check">
                                    <input type="checkbox" id="vacCheckbox" name="TypeClass" class="form-check-input" value="VAC" onchange="toggleVACSection()" />
                                    <label class="form-check-label fw-bold text-dark" for="vacCheckbox">VAC</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="ivacCheckbox" name="TypeClass" class="form-check-input" value="IVAC" onchange="toggleIVACSection()" />
                                    <label class="form-check-label fw-bold text-dark" for="ivacCheckbox">IVAC</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="pvapCheckbox" name="TypeClass" class="form-check-input" value="PVAP" onchange="togglePVAPSection()" />
                                    <label class="form-check-label fw-bold text-dark" for="pvapCheckbox">PVAP</label>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- VAC Section (Hidden by Default) -->
                <div id="vacSection" style="display: none;" class="animated-section">
                    <hr class="my-4" />
                    <div class="card mt-4">
                        <div class="card-header bg-danger text-white">
                            <h5 class="text-center">VENTILATOR ASSOCIATED CONDITION (VAC)</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Baseline period of improvement or stability* on the ventilator</strong></p>
                            <div class="form-check">
                                <input asp-for="Vac1" class="form-check-input" type="checkbox" />
                                <label class="form-check-label" for="Vac1">Daily minimum FiO2 increase >= 0.20 (20 points) for >= 2 days, OR</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Vac2" class="form-check-input" type="checkbox" />
                                <label class="form-check-label" for="Vac2">Daily minimum PEEP increase >= 3 cm H20 for >= 2 days</label>
                            </div>
                        </div>
                    </div>
                </div>

                    <!-- IVAC Section (Hidden by Default) -->
                    <div id="ivacSection" style="display: none;" class="animated-section">
                        <hr class="my-4" />
                        <div class="card mt-4">
                            <div class="card-header bg-warning text-white">
                                <h5 class="text-center">INFECTION-RELATED VENTILATOR-ASSOCIATED COMPLICATION (IVAC)</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-check">
                                    <input asp-for="IVac1" type="checkbox" class="form-check-input" value="true">
                                    <label class="form-check-label">Temperature > 38°C or < 36°C</label>
                                </div>
                                <div class="form-check">
                                    <input asp-for="IVac2" type="checkbox" class="form-check-input" value="true" id="ivac2Checkbox" onchange="toggleIVac3Checkbox()">
                                    <label class="form-check-label">White blood cell count ≥ 12,000 or ≤ 4,000 cells/mm³</label>
                                </div>
                                <!-- IVac3 Checkbox (Hidden by Default) -->
                                <div id="ivac3CheckboxContainer" style="display: none;">
                                    <div class="form-check">
                                        <input asp-for="IVac3" type="checkbox" class="form-check-input" value="true">
                                        <label class="form-check-label">A new antimicrobial agent is started and continued for ≥ 4 days</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- PVAP Section (Hidden by Default) -->
                <div id="pvapSection" style="display: none;" class="animated-section">
                    <hr class="my-4" />
                    <div class="card mt-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="text-center">POSSIBLE VENTILATOR-ASSOCIATED PNEUMONIA (PVAP)</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Patient must meet one of the following criteria:</strong></p>

                            <h6 class="text-primary">Criterion 1: Positive culture</h6>
                            <div class="form-check">
                                <input asp-for="Pvap1Endo" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Endotracheal aspirate</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap1Lung" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Bronchoalveolar lavage</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap1Bronch" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Lung tissue</label>
                            </div>

                            <h6 class="text-primary">Criterion 2: Purulent respiratory secretions</h6>
                            <div class="form-check">
                                <input asp-for="Pvap2Sputum" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Sputum</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap2Endo" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Endotracheal aspirate</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap2Lung" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Lung tissue</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap2Bronch" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Bronchoalveolar lavage</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap2Specimen" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Protected specimen brush</label>
                            </div>

                            <h6 class="text-primary">Criterion 3: Other Positive Tests</h6>
                            <div class="form-check">
                                <input asp-for="Pvap3Organism" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Organism(s) identified from pleural fluid</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap3Lung" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Lung Histopathology</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap3Legionella" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Diagnostic test for Legionella species</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="Pvap3Viral" type="checkbox" class="form-check-input" value="true">
                                <label class="form-check-label">Diagnostic test for selected viral pathogens</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Culture Information -->
                    <div class="card mt-4">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="text-center">Culture Results</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Culture Results -->
                                <div class="col-md-5">
                                    <label>Culture Results:</label>
                                    <textarea asp-for="PvapResult" class="form-control" rows="3"></textarea>
                                </div>

                                <!-- VAE Remarks -->
                                <div class="col-md-5">
                                    <label>VAE Remarks:</label>
                                    <textarea asp-for="VaeRemarks" class="form-control" rows="3"></textarea>
                                </div>

                                <!-- Culture Date -->
                                <div class="col-md-2">
                                    <label>Culture Date:</label>
                                    <input asp-for="PvapCultureDate" type="date" class="form-control" required />
                                </div>
                            </div>
                        </div>
                    </div>
                <div asp-validation-summary="All" class="text-danger"></div>


                <!-- Submit Button -->
                <div class="row mt-4">
                    <div class="col text-center">
                        <button type="submit" class="btn btn-primary mt-3">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<script>
    // Function to toggle VAC section visibility
    function toggleVACSection() {
        const vacSection = document.getElementById('vacSection');
        const vacCheckbox = document.getElementById('vacCheckbox');
        if (vacCheckbox.checked) {
            vacSection.style.display = 'block'; // Show the section
            setTimeout(() => vacSection.classList.add('show'), 10); // Add fade-in effect
        } else {
            vacSection.classList.remove('show'); // Start fade-out effect
            setTimeout(() => vacSection.style.display = 'none', 300); // Hide after animation
        }
    }

    // Function to toggle IVAC section visibility
    function toggleIVACSection() {
        const ivacSection = document.getElementById('ivacSection');
        const ivacCheckbox = document.getElementById('ivacCheckbox');
        if (ivacCheckbox.checked) {
            ivacSection.style.display = 'block'; // Show the section
            setTimeout(() => ivacSection.classList.add('show'), 10); // Add fade-in effect
        } else {
            ivacSection.classList.remove('show'); // Start fade-out effect
            setTimeout(() => ivacSection.style.display = 'none', 300); // Hide after animation
        }
    }

    // Function to toggle PVAP section visibility
    function togglePVAPSection() {
        const pvapSection = document.getElementById('pvapSection');
        const pvapCheckbox = document.getElementById('pvapCheckbox');
        if (pvapCheckbox.checked) {
            pvapSection.style.display = 'block'; // Show the section
            setTimeout(() => pvapSection.classList.add('show'), 10); // Add fade-in effect
        } else {
            pvapSection.classList.remove('show'); // Start fade-out effect
            setTimeout(() => pvapSection.style.display = 'none', 300); // Hide after animation
        }
    }
        // Function to toggle Disposition Transfer field visibility
    function toggleDispositionTransferField() {
        const dispositionDropdown = document.getElementById('dispositionDropdown');
        const dispositionTransferField = document.getElementById('dispositionTransferField');

        // Check if "Transferred In" or "Transferred Out" is selected
        if (dispositionDropdown.value === "Transferred In" || dispositionDropdown.value === "Transferred Out") {
            dispositionTransferField.style.display = 'block'; // Show the field
            setTimeout(() => dispositionTransferField.classList.add('show'), 10); // Add fade-in effect
        } else {
            dispositionTransferField.classList.remove('show'); // Start fade-out effect
            setTimeout(() => dispositionTransferField.style.display = 'none', 300); // Hide after animation
        }
    }
    // Function to toggle MDROOrganism field visibility
    function toggleMDROOrganismField() {
        const mdroYes = document.getElementById('mdroYes');
        const mdroOrganismField = document.getElementById('mdroOrganismField');

        // Check if "Yes" is selected
        if (mdroYes.checked) {
            mdroOrganismField.style.display = 'flex'; // Show the field
            setTimeout(() => mdroOrganismField.classList.add('show'), 10); // Add fade-in effect
        } else {
            mdroOrganismField.classList.remove('show'); // Start fade-out effect
            setTimeout(() => mdroOrganismField.style.display = 'none', 300); // Hide after animation
        }
    }
    // Function to toggle IVac3 checkbox visibility
    function toggleIVac3Checkbox() {
        const ivac2Checkbox = document.getElementById('ivac2Checkbox');
        const ivac3CheckboxContainer = document.getElementById('ivac3CheckboxContainer');
        const ivac3Checkbox = ivac3CheckboxContainer.querySelector('input[type="checkbox"]');

        if (ivac2Checkbox.checked) {
            ivac3CheckboxContainer.style.display = 'block'; // Show IVac3 container
            setTimeout(() => ivac3CheckboxContainer.classList.add('show'), 10); // Add fade-in effect
        } else {
            ivac3Checkbox.checked = false; // Uncheck IVac3 when IVac2 is unchecked
            ivac3CheckboxContainer.classList.remove('show'); // Start fade-out effect
            setTimeout(() => {
                ivac3CheckboxContainer.style.display = 'none'; // Hide after animation
            }, 300);
        }
    }
</script>

<style>

    /* Styling the card */
    .card {
        border-radius: 12px;
        overflow: hidden;
    }

    /* Styling checkboxes */
    .form-check-input {
        transform: scale(1.2);
        margin-right: 5px;
    }

    /* Align checkboxes horizontally */
    .d-flex {
        display: flex;
        flex-wrap: wrap;
    }

    /* Adjust spacing */
    .gap-3 {
        gap: 15px;
    }

    /* Animation for sections */
    #vacSection,
    #ivacSection,
    #pvapSection {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        display: none; /* Initially hidden */
    }

        #vacSection.show,
        #ivacSection.show,
        #pvapSection.show {
            opacity: 1; /* Fully visible */
        }

    /* Animation for Disposition Transfer field */
    #dispositionTransferField {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        display: none; /* Initially hidden */
    }

        #dispositionTransferField.show {
            opacity: 1; /* Fully visible */
            display: block; /* Show the field */
        }
    /* Animation for MDROOrganism field */
    #mdroOrganismField {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        display: none; /* Initially hidden */
    }

        #mdroOrganismField.show {
            opacity: 1; /* Fully visible */
            display: flex; /* Show the field */
        }
    /* Animation for IVac3 checkbox container */
    #ivac3CheckboxContainer {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        display: none; /* Initially hidden */
    }

    #ivac3CheckboxContainer.show {
        opacity: 1; /* Fully visible */
        display: block; /* Show the container */
    }
</style>