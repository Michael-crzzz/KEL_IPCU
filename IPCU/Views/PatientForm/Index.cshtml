@model IEnumerable<IPCU.Models.PatientForm>

@{
    ViewData["Title"] = "Patient Records";
}

<!-- Bootstrap & Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<div class="container mt-5">
    <!-- Title & Add Patient Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary fw-bold"><i class="fa fa-hospital-user"></i> Patient Records</h2>
        <a asp-action="Create" class="btn btn-success btn-lg">
            <i class="fa fa-plus"></i> Add Patient
        </a>
    </div>

    <!-- Search & Filter -->
    <div class="row mb-3">
        <div class="col-md-4">
            <input type="text" id="searchInput" class="form-control shadow-sm" placeholder="🔍 Search Patient...">
        </div>
        <div class="col-md-4">
            <select id="filterStatus" class="form-select shadow-sm">
                <option value="">📌 Filter by Status</option>
                <option value="Active">Active</option>
                <option value="Discharged">Discharged</option>
                <option value="Under Treatment">Under Treatment</option>
            </select>
        </div>
    </div>

    <!-- Patient Table -->
    <div class="table-responsive">
        <table class="table table-hover table-bordered text-center shadow-sm" id="patientTable">
            <thead class="table-primary sticky-top">
                <tr>
                    <th>First Name</th>
                    <th>Middle Name</th>
                    <th>Last Name</th>
                    <th>Suffix</th>
                    <th>Disease</th>
                    <th>Status</th>
                    <th>Room</th>
                    <th>Building</th>
                    <th>Age</th>
                    <th>Sex</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.FirstName)</td>
                        <td>@Html.DisplayFor(modelItem => item.MiddleName)</td>
                        <td>@Html.DisplayFor(modelItem => item.LastName)</td>
                        <td>@Html.DisplayFor(modelItem => item.Suffix)</td>
                        <td>@Html.DisplayFor(modelItem => item.Disease)</td>
                        <td>
                            <span class="badge @(item.Status == "Active" ? "bg-success" : (item.Status == "Under Treatment" ? "bg-warning text-dark" : "bg-danger"))">
                                @Html.DisplayFor(modelItem => item.Status)
                            </span>
                        </td>
                        <td>@Html.DisplayFor(modelItem => item.Room)</td>
                        <td>@Html.DisplayFor(modelItem => item.Building)</td>
                        <td>@Html.DisplayFor(modelItem => item.Age)</td>
                        <td>@Html.DisplayFor(modelItem => item.Sex)</td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm" data-bs-toggle="tooltip" title="Edit Patient">
                                <i class="fa fa-edit"></i>
                            </a>
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-info btn-sm" data-bs-toggle="tooltip" title="View Details">
                                <i class="fa fa-eye"></i>
                            </a>
                            <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm" data-bs-toggle="tooltip" title="Delete Patient">
                                <i class="fa fa-trash"></i>
                            </a>
                            <a asp-action="PrintPdf" asp-route-id="@item.Id" target="_blank" class="btn btn-secondary btn-sm" data-bs-toggle="tooltip" title="Print PDF">
                                <i class="fa fa-print"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- JavaScript for Search & Filter -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchInput");
        const filterStatus = document.getElementById("filterStatus");
        const table = document.getElementById("patientTable").getElementsByTagName("tbody")[0];  

        var pdfUrl = '@TempData["PdfUrl"]';
        if (pdfUrl) {
            window.open(pdfUrl, '_blank'); // Opens PDF in a new tab
        }

        searchInput.addEventListener("keyup", function () {
            let filter = searchInput.value.toLowerCase();
            let rows = table.getElementsByTagName("tr");
            for (let row of rows) {
                let text = row.innerText.toLowerCase();
                row.style.display = text.includes(filter) ? "" : "none";
            }
        });

        filterStatus.addEventListener("change", function () {
            let status = filterStatus.value.toLowerCase();
            let rows = table.getElementsByTagName("tr");
            for (let row of rows) {
                let cell = row.cells[5]; // Status column index
                row.style.display = (status === "" || cell.innerText.toLowerCase() === status) ? "" : "none";
            }
        });

        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltip
    </script>