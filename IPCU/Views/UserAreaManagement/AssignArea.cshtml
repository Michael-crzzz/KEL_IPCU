@model IPCU.Models.AssignAreaViewModel
@{
    ViewData["Title"] = "Assign Area";
}
<div class="container">
    <h2>Assign Area</h2>
    <div class="row">
        <div class="col-md-8">
            <form asp-action="AssignArea" method="post">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" asp-for="UserId" />

                <div class="form-group mb-3">
                    <label>Username</label>
                    <input asp-for="UserName" class="form-control" readonly />
                </div>

                <div class="form-group mb-3">
                    <label>Full Name</label>
                    <input asp-for="FullName" class="form-control" readonly />
                </div>

                <div class="form-group mb-3">
                    <label>Current Assigned Areas</label>
                    <!-- Changed from readonly to hidden to still submit the value -->
                    <input asp-for="AssignedArea" id="AssignedArea" name="AssignedArea" class="form-control" />
                </div>

                <div class="form-group mb-3">
                    <label>Select Areas</label>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2A" value="Unit 2A" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2A">Unit 2A</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2B" value="Unit 2B" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2B">Unit 2B</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2C" value="Unit 2C" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2C">Unit 2C</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2D" value="Unit 2D" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2D">Unit 2D</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2E" value="Unit 2E" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2E">Unit 2E</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2F" value="Unit 2F" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2F">Unit 2F</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2G" value="Unit 2G" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2G">Unit 2G</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_2H" value="Unit 2H" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_2H">Unit 2H</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="2B_Extension" value="2B Extension" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="2B_Extension">2B Extension</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="2D_Extension" value="2D Extension" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="2D_Extension">2D Extension</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="2E_Extension" value="2E Extension" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="2E_Extension">2E Extension</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_3A" value="Unit 3A" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_3A">Unit 3A</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_3B" value="Unit 3B" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_3B">Unit 3B</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_3C" value="Unit 3C" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_3C">Unit 3C</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_3D" value="Unit 3D" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_3D">Unit 3D</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_3E" value="Unit 3E" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_3E">Unit 3E</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input type="checkbox" id="Unit_3F" value="Unit 3F" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Unit_3F">Unit 3F</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="CTU" value="CTU" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="CTU">CTU</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="PDU" value="PDU" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="PDU">PDU</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="CCRU" value="CCRU" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="CCRU">CCRU</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Cardiology" value="Cardiology" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Cardiology">Cardiology</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Laboratory" value="Laboratory" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Laboratory">Laboratory</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Radiology" value="Radiology" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Radiology">Radiology</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="Rehab" value="Rehab" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="Rehab">Rehab</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="OR-RR" value="OR-RR" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="OR-RR">OR-RR</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="OPS" value="OPS" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="OPS">OPS</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="AITU" value="AITU" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="AITU">AITU</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="IVASC" value="IVASC" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="IVASC">IVASC</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="AUEC" value="AUEC" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="AUEC">AUEC</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="ICU_IMCU" value="ICU/IMCU" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="ICU_IMCU">ICU/IMCU</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="ER" value="ER" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="ER">ER</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="PULMO" value="PULMO" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="PULMO">PULMO</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="HD_Annex" value="HD Annex" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="HD_Annex">HD Annex</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="HD_Main" value="HD Main" class="area-checkbox form-check-input" />
                                        <label class="form-check-label" for="HD_Main">HD Main</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-2">
                        <button type="button" id="selectAll" class="btn btn-sm btn-outline-primary">Select All</button>
                        <button type="button" id="deselectAll" class="btn btn-sm btn-outline-secondary">Deselect All</button>
                    </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <a asp-action="Index" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function() {
            // Function to update the AssignedArea text field based on selected checkboxes
            function updateAssignedArea() {
                var selectedAreas = [];
                $('.area-checkbox:checked').each(function() {
                    selectedAreas.push($(this).val());
                });
                $('#AssignedArea').val(selectedAreas.join(', '));
            }

            // Function to check if areas are already assigned
            function checkSelectedAreas() {
                var currentAreas = $("#AssignedArea").val();
                if (currentAreas) {
                    var areaArray = currentAreas.split(',').map(function(item) {
                        return item.trim();
                    });

                    // Check the boxes for existing areas
                    $(".area-checkbox").each(function() {
                        if (areaArray.includes($(this).val())) {
                            $(this).prop('checked', true);
                        }
                    });
                }
            }

            // Select all button
            $("#selectAll").click(function() {
                $(".area-checkbox").prop('checked', true);
                updateAssignedArea();
            });

            // Deselect all button
            $("#deselectAll").click(function() {
                $(".area-checkbox").prop('checked', false);
                updateAssignedArea();
            });

            // Update AssignedArea when any checkbox is clicked
            $(".area-checkbox").on('change', function() {
                updateAssignedArea();
            });

            // Check boxes based on current assignments and then update the text field
            checkSelectedAreas();
            updateAssignedArea();

            // Add form validation to ensure form submission works correctly
            $("form").submit(function() {
                // Update assigned areas one final time before submitting
                updateAssignedArea();

                // Optional: ensure at least one area is selected
                if($(".area-checkbox:checked").length === 0) {
                    alert("Please select at least one area.");
                    return false;
                }
                return true;
            });
        });
    </script>
}