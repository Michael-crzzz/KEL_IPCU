@model IPCU.Models.AssignAreaViewModel

@{
    ViewData["Title"] = "Assign Area";
}

<div class="container py-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Assign Area</h4>
        </div>
        <div class="card-body">
            <form asp-action="AssignArea" method="post">
                <input type="hidden" asp-for="UserId" />
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Username</label>
                        <input asp-for="UserName" class="form-control" readonly />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Full Name</label>
                        <input asp-for="FullName" class="form-control" readonly />
                    </div>
                </div>

                <input asp-for="AssignedArea" id="AssignedArea" name="AssignedArea" type="hidden" />

                <div class="mb-3">
                    <label class="form-label fw-bold">Select Areas</label>
                    <div class="accordion" id="areaAccordion">
                        @foreach (var group in new[] {
                        new { Title = "Unit 2", Areas = new[] { "Unit 2A", "Unit 2B", "Unit 2C", "Unit 2D", "Unit 2E", "Unit 2F", "Unit 2G", "Unit 2H", "2B Extension", "2D Extension", "2E Extension" } },
                        new { Title = "Unit 3", Areas = new[] { "Unit 3A", "Unit 3B", "Unit 3C", "Unit 3D", "Unit 3E", "Unit 3F" } },
                        new { Title = "Other Areas", Areas = new[] { "CTU", "PDU", "CCRU", "Cardiology", "Laboratory", "Radiology", "Rehab", "OR-RR", "OPS", "AITU", "IVASC", "AUEC", "ICU/IMCU", "ER", "PULMO", "HD Annex", "HD Main" } }
                        })
                        {
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading-@group.Title.Replace(" ", "")">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@group.Title.Replace(" ", "")" aria-expanded="false">
                                        @group.Title
                                    </button>
                                </h2>
                                <div id="collapse-@group.Title.Replace(" ", "")" class="accordion-collapse collapse" data-bs-parent="#areaAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            @foreach (var area in group.Areas)
                                            {
                                                <div class="col-sm-6 col-md-4">
                                                    <div class="form-check">
                                                        <input type="checkbox" id="@area.Replace(" ", "_")" value="@area" class="area-checkbox form-check-input" />
                                                        <label class="form-check-label" for="@area.Replace(" ", "_")">@area</label>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="mt-3">
                        <button type="button" id="selectAll" class="btn btn-outline-primary btn-sm me-2">Select All</button>
                        <button type="button" id="deselectAll" class="btn btn-outline-secondary btn-sm">Deselect All</button>
                    </div>
                </div>

                <div class="d-flex justify-content-end">
                    <a asp-action="Index" class="btn btn-secondary me-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $(document).ready(function () {
            function updateAssignedArea() {
                const selected = $(".area-checkbox:checked").map(function () {
                    return $(this).val();
                }).get();
                $("#AssignedArea").val(selected.join(", "));
            }

            function preSelectAreas() {
                const current = $("#AssignedArea").val().split(",").map(a => a.trim());
                $(".area-checkbox").each(function () {
                    if (current.includes($(this).val())) {
                        $(this).prop("checked", true);
                    }
                });
            }

            $("#selectAll").click(function () {
                $(".area-checkbox").prop("checked", true);
                updateAssignedArea();
            });

            $("#deselectAll").click(function () {
                $(".area-checkbox").prop("checked", false);
                updateAssignedArea();
            });

            $(".area-checkbox").change(updateAssignedArea);

            preSelectAreas();
            updateAssignedArea();

            $("form").submit(function () {
                updateAssignedArea();
                if ($(".area-checkbox:checked").length === 0) {
                    alert("Please select at least one area.");
                    return false;
                }
                return true;
            });
        });
    </script>
}
