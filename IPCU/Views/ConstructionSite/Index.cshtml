@model IPCU.Models.ConstructionSite
@using System.Text.RegularExpressions
@using Microsoft.AspNetCore.Html

@{
    ViewBag.Title = "Infection Prevention and Control Construction Site Monitoring Tool";
}

@using (Html.BeginForm("SubmitForm", "ConstructionSite", FormMethod.Post))
{
    <h2 class="text-center">INFECTION PREVENTION AND CONTROL<br />CONSTRUCTION SITE MONITORING TOOL</h2>

    <p><strong>Note:</strong> This form is used for compliance and quality monitoring by the infection control professional or other member of the multidisciplinary team to monitor preventive measures required during construction/renovation activities.</p>

    <a class="btn btn-primary" href="/ConstructionSite/List">View All Submissions</a>
    <table class="table table-bordered">
        <tr>
            <th>Project Reference Number:</th>
            <td>@Html.TextBoxFor(m => m.ProjectReferenceNumber, new { @class = "form-control" })</td>
            <th>Project/Activity Name and Description:</th>
            <td>@Html.TextBoxFor(m => m.ProjectNameAndDescription, new { @class = "form-control" })</td>
        </tr>
        <tr>
            <th>Contractor/Supplier Representative (Name):</th>
            <td>@Html.TextBoxFor(m => m.ContractorRepresentativeName, new { @class = "form-control" })</td>
            <th>Telephone/Mobile number:</th>
            <td>@Html.TextBoxFor(m => m.TelephoneOrMobileNumber, new { @class = "form-control" })</td>
        </tr>
        <tr>
            <th>Specific Site of the Activity</th>
            <td colspan="3">@Html.TextBoxFor(m => m.SpecificSiteOfActivity, new { @class = "form-control" })</td>
        </tr>
        <tr>
            <th>Scope of Work (Brief Summary):</th>
            <td colspan="3">@Html.TextAreaFor(m => m.ScopeOfWork, new { @class = "form-control", rows = 3 })</td>
        </tr>
        <tr>
            <th>Project Start Date:</th>
            <td>@Html.TextBoxFor(m => m.ProjectStartDate, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })</td>
            <th>Estimated Duration:</th>
            <td>@Html.TextBoxFor(m => m.EstimatedDuration, new { @class = "form-control" })</td>
        </tr>
    </table>

    <h4 class="mt-4">Preventive Measures</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>PREVENTIVE MEASURE</th>
                <th>Yes</th>
                <th>No</th>
                <th>N/A</th>
                <th>COMMENTS</th>
            </tr>
        </thead>
        <tbody>
            <tr><td colspan="5"><strong>Barriers</strong></td></tr>
            @Html.Raw(RenderMeasureRow("ICRA or applicable signage is posted in the area", nameof(Model.BarrierICRA), Model.BarrierICRA, nameof(Model.BarrierICRAComments), Model.BarrierICRAComments))
            @Html.Raw(RenderMeasureRow("Doors properly closed and sealed", nameof(Model.BarrierDoorsSealedSelection), Model.BarrierDoorsSealedSelection, nameof(Model.BarrierDoorsSealedComments), Model.BarrierDoorsSealedComments))
            @Html.Raw(RenderMeasureRow("Floor area is clean, with no dust tracked", nameof(Model.BarrierFloorCleanSelection), Model.BarrierFloorCleanSelection, nameof(Model.BarrierFloorCleanComments), Model.BarrierFloorCleanComments))
            @Html.Raw(RenderMeasureRow("Walk-off mats clean, and are free of debris", nameof(Model.BarrierWalkOffMatsSelection), Model.BarrierWalkOffMatsSelection, nameof(Model.BarrierWalkOffMatsComments), Model.BarrierWalkOffMatsComments))
            @Html.Raw(RenderMeasureRow("Tape adhering to surface", nameof(Model.BarrierTapeAdheringSelection), Model.BarrierTapeAdheringSelection, nameof(Model.BarrierTapeAdheringComments), Model.BarrierTapeAdheringComments))

            <tr><td colspan="5"><strong>Air handling</strong></td></tr>
            @Html.Raw(RenderMeasureRow("All windows closed behind barrier", nameof(Model.AirhandlingWindowsClosedBehindBarrierSelection), Model.AirhandlingWindowsClosedBehindBarrierSelection, nameof(Model.AirhandlingWindowsClosedBehindBarrierComments), Model.AirhandlingWindowsClosedBehindBarrierComments))
            @Html.Raw(RenderMeasureRow("Negative air monitored at entrance, with anteroom", nameof(Model.AirhandlingNegativeAirMonitoredSelection), Model.AirhandlingNegativeAirMonitoredSelection, nameof(Model.AirhandlingNegativeAirMonitoredComments), Model.AirhandlingNegativeAirMonitoredComments))
            @Html.Raw(RenderMeasureRow("Construction air handling unit running", nameof(Model.AirHandlingUnitRunningSelection), Model.AirHandlingUnitRunningSelection, nameof(Model.AirHandlingUnitRunningComments), Model.AirHandlingUnitRunningComments))
            @Html.Raw(RenderMeasureRow("Current maintenance label visible", nameof(Model.AirhandlingMaintenanceLabelVisibleSelection), Model.AirhandlingMaintenanceLabelVisibleSelection, nameof(Model.AirhandlingMaintenanceLabelVisibleComments), Model.AirhandlingMaintenanceLabelVisibleComments))
            @Html.Raw(RenderMeasureRow("Air exhausted to appropriate area", nameof(Model.AirhandlingAirExhaustedToAppropriateAreaSelection), Model.AirhandlingAirExhaustedToAppropriateAreaSelection, nameof(Model.AirhandlingAirExhaustedToAppropriateAreaComments), Model.AirhandlingAirExhaustedToAppropriateAreaComments))


            <!-- Project area -->
            <tr><td colspan="5"><strong>Project area</strong></td></tr>
            <!-- Project area -->
            <tr><td colspan="5"><strong>Project area</strong></td></tr>
            @Html.Raw(RenderMeasureRow("HEPA-filtered vacuum on job site", nameof(Model.ProjectareaHEPAFilteredVacuumOnJobsiteSelection), Model.ProjectareaHEPAFilteredVacuumOnJobsiteSelection, nameof(Model.ProjectareaHEPAFilteredVacuumOnJobsiteComments), Model.ProjectareaHEPAFilteredVacuumOnJobsiteComments))
            @Html.Raw(RenderMeasureRow("Debris removed in covered container daily", nameof(Model.ProjectareaDebrisRemovedInCoveredContainerDailySelection), Model.ProjectareaDebrisRemovedInCoveredContainerDailySelection, nameof(Model.ProjectareaDebrisRemovedInCoveredContainerDailyComments), Model.ProjectareaDebrisRemovedInCoveredContainerDailyComments))
            @Html.Raw(RenderMeasureRow("Designated construction route or map posted, and staff oriented", nameof(Model.ProjectareaDesignatedConstructionRouteOrMapPostedSelection), Model.ProjectareaDesignatedConstructionRouteOrMapPostedSelection, nameof(Model.ProjectareaDesignatedConstructionRouteOrMapPostedComments), Model.ProjectareaDesignatedConstructionRouteOrMapPostedComments))
            @Html.Raw(RenderMeasureRow("Trash in appropriate container", nameof(Model.ProjectareaTrashInAppropriateContainerSelection), Model.ProjectareaTrashInAppropriateContainerSelection, nameof(Model.ProjectareaTrashInAppropriateContainerComments), Model.ProjectareaTrashInAppropriateContainerComments))
            @Html.Raw(RenderMeasureRow("Routine cleaning done on site", nameof(Model.ProjectareaRoutineCleaningDoneOnSiteSelection), Model.ProjectareaRoutineCleaningDoneOnSiteSelection, nameof(Model.ProjectareaRoutineCleaningDoneOnSiteComments), Model.ProjectareaRoutineCleaningDoneOnSiteComments))
            @Html.Raw(RenderMeasureRow("Air vents sealed or duct work capped", nameof(Model.ProjectareaAirVentsSealedOrDuctworkCappedSelection), Model.ProjectareaAirVentsSealedOrDuctworkCappedSelection, nameof(Model.ProjectareaAirVentsSealedOrDuctworkCappedComments), Model.ProjectareaAirVentsSealedOrDuctworkCappedComments))

            <!-- Traffic control -->
            <tr><td colspan="5"><strong>Traffic control</strong></td></tr>
            @Html.Raw(RenderMeasureRow("Restricted to construction workers and necessary staff only", nameof(Model.TrafficcontrolRestrictedToConstructionWorkersSelection), Model.TrafficcontrolRestrictedToConstructionWorkersSelection, nameof(Model.TrafficcontrolRestrictedToConstructionWorkersComments), Model.TrafficcontrolRestrictedToConstructionWorkersComments))
            @Html.Raw(RenderMeasureRow("All doors and exits free of debris", nameof(Model.TrafficcontrolDoorsAndExitsFreeOfDebrisSelection), Model.TrafficcontrolDoorsAndExitsFreeOfDebrisSelection, nameof(Model.TrafficcontrolDoorsAndExitsFreeOfDebrisComments), Model.TrafficcontrolDoorsAndExitsFreeOfDebrisComments))

            <!-- Dress code -->
            <tr><td colspan="5"><strong>Dress code</strong></td></tr>
            @Html.Raw(RenderMeasureRow("Protective clothing worn when required", nameof(Model.DresscodeProtectiveClothingWornSelection), Model.DresscodeProtectiveClothingWornSelection, nameof(Model.DresscodeProtectiveClothingWornComments), Model.DresscodeProtectiveClothingWornComments))
            @Html.Raw(RenderMeasureRow("Workers clothing clean upon exiting work space", nameof(Model.DresscodeWorkersClothingCleanUponExitingSelection), Model.DresscodeWorkersClothingCleanUponExitingSelection, nameof(Model.DresscodeWorkersClothingCleanUponExitingComments), Model.DresscodeWorkersClothingCleanUponExitingComments))

            <!-- Same pattern continues for Project area, Traffic control, Dress code -->
        </tbody>
    </table>

    <h4 class="mt-5">Reported to:</h4>
    <table class="table borderless" style="width: 100%; margin-top: 30px;">
        <tr>
            <td>
                <strong>Contractor/Supplier Representative</strong><br />
                Signature over printed name and Date signed<br />
                @Html.TextBoxFor(m => m.ContractorSign, new { @class = "form-control" })
            </td>
            <td>
                <strong>NKTI Engineering Staff Representative</strong><br />
                Signature over printed name and Date signed<br />
                @Html.TextBoxFor(m => m.EngineeringSign, new { @class = "form-control" })
            </td>
        </tr>
        <tr>
            <td>
                <strong>Infection Control Representative</strong><br />
                Signature over printed name and Date signed<br />
                @Html.TextBoxFor(m => m.ICPSign, new { @class = "form-control" })
            </td>
            <td>
                <strong>Unit/Area Representative</strong><br />
                Signature over printed name and Date signed<br />
                @Html.TextBoxFor(m => m.UnitAreaRep, new { @class = "form-control" })
            </td>
        </tr>
    </table>

    <div class="mt-4 d-flex justify-content-between align-items-end">
        <div style="border: 2px solid #000; padding: 15px; width: 50%; font-size: 0.9rem;">
            This form is used for compliance and quality monitoring by the infection control professional<br />
            or other member of the multidisciplinary team to monitor preventive measures required<br />
            during construction/renovation activities.<br />
            <strong>Failure to observe the measures, as discussed, might result to penalty or other actions necessary.</strong>
        </div>
        <div style="text-align: right; font-style: italic;">
            IPC-WIF-014b_ver1
        </div>
    </div>

    <div class="mt-4">
        <input type="submit" value="Submit Form" class="btn btn-primary" />
    </div>
}

@functions {
    public IHtmlContent RenderMeasureRow(string label, string selectionName, string selectionValue, string commentName, string commentValue)
    {
        var groupName = Regex.Replace(label, @"[^a-zA-Z0-9]", "");
        return new HtmlString(
            "<tr>" +
            $"<td>{label}</td>" +
            $"<td><input type='radio' name='{selectionName}' value='Yes' {(selectionValue == "Yes" ? "checked" : "")} /></td>" +
            $"<td><input type='radio' name='{selectionName}' value='No' {(selectionValue == "No" ? "checked" : "")} /></td>" +
            $"<td><input type='radio' name='{selectionName}' value='N/A' {(selectionValue == "N/A" ? "checked" : "")} /></td>" +
            $"<td><input type='text' name='{commentName}' value='{commentValue}' class='form-control' /></td>" +
            "</tr>"
        );
    }
}
